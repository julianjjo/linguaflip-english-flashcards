const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/Header.astro_astro_type_script_index_0_lang.D70yTJYG.js","_astro/react-vendor.DGywmNEQ.js","_astro/state-vendor.AbkSLUgN.js","_astro/vendor.QRJdyujs.js","_astro/utils.C1pdIpZs.js","_astro/hooks.Bgys84ol.js"])))=>i.map(i=>d[i]);
import{r as j,j as e,R as O}from"./react-vendor.DGywmNEQ.js";import{u as A,L as P,A as F}from"./Header.astro_astro_type_script_index_0_lang.D70yTJYG.js";import{m as H,a as S}from"./state-vendor.AbkSLUgN.js";const D="modulepreload",T=function(r){return"/"+r},I={},R=function(d,l,o){let i=Promise.resolve();if(l&&l.length>0){let a=function(t){return Promise.all(t.map(h=>Promise.resolve(h).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),u=n?.nonce||n?.getAttribute("nonce");i=a(l.map(t=>{if(t=T(t),t in I)return;I[t]=!0;const h=t.endsWith(".css"),m=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${t}"]${m}`))return;const g=document.createElement("link");if(g.rel=h?"stylesheet":D,h||(g.as="script"),g.crossOrigin="",g.href=t,u&&g.setAttribute("nonce",u),document.head.appendChild(g),h)return new Promise((E,C)=>{g.addEventListener("load",E),g.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${t}`)))})}))}function s(a){const n=new Event("vite:preloadError",{cancelable:!0});if(n.payload=a,window.dispatchEvent(n),!n.defaultPrevented)throw a}return i.then(a=>{for(const n of a||[])n.status==="rejected"&&s(n.reason);return d().catch(s)})},c=S([]),$=S(null);H({currentView:"study",previousView:null});const x=S(!1),f=S(null);let N=null;const k=async()=>{if(typeof window>"u")return null;if(!N){const{hybridStorage:r}=await R(async()=>{const{hybridStorage:d}=await import("./Header.astro_astro_type_script_index_0_lang.D70yTJYG.js").then(l=>l.e);return{hybridStorage:d}},__vite__mapDeps([0,1,2,3,4,5]));N=r,r.getSyncStatusStore()}return N};let w=null;const B=r=>{w=r},q={async loadFlashcards(r){const d=r||w;if(!d){console.warn("No user ID provided for loading flashcards");return}try{x.set(!0),f.set(null);try{const i=await fetch("/api/flashcards/list",{credentials:"include"});if(i.ok){const s=await i.json();if(s.success&&s.data?.flashcards){c.set(s.data.flashcards);return}}}catch(i){console.warn("API load failed, falling back to hybrid storage:",i)}const l=await k();if(!l){console.warn("Hybrid storage not available (server-side)");return}const o=await l.getFlashcards(d);c.set(o)}catch(l){const o=l instanceof Error?l.message:"Failed to load flashcards";f.set(o),console.error("Failed to load flashcards:",l)}finally{x.set(!1)}},async saveFlashcard(r,d){const l=d||w;if(!l){console.warn("No user ID provided for saving flashcard"),c.set([...c.get(),r]);return}try{x.set(!0),f.set(null);let o=!1;try{const a=r.id?`/api/flashcards/${r.id}`:"/api/flashcards/create",n=r.id?"PUT":"POST",u=await fetch(a,{method:n,headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({english:r.english,spanish:r.spanish,exampleEnglish:r.exampleEnglish,exampleSpanish:r.exampleSpanish,image:r.image,category:r.category||"general",tags:r.tags||[]})});if(u.ok){const t=await u.json();t.success&&t.data?.flashcard&&(r=t.data.flashcard,o=!0)}}catch(a){console.warn("API save failed, falling back to hybrid storage:",a)}if(!o){const a=await k();a&&await a.saveFlashcard(l,r)}const i=c.get(),s=i.findIndex(a=>a.id===r.id);if(s>=0){const a=[...i];a[s]=r,c.set(a)}else c.set([...i,r])}catch(o){const i=o instanceof Error?o.message:"Failed to save flashcard";f.set(i),console.error("Failed to save flashcard:",o);const s=c.get(),a=s.findIndex(n=>n.id===r.id);if(a>=0){const n=[...s];n[a]=r,c.set(n)}else c.set([...s,r])}finally{x.set(!1)}},async deleteFlashcard(r,d){const l=d||w;if(!l){console.warn("No user ID provided for deleting flashcard");const i=c.get().filter(s=>s.id!==r);c.set(i);return}try{x.set(!0),f.set(null);let o=!1;try{const a=await fetch(`/api/flashcards/${r}`,{method:"DELETE",credentials:"include"});a.ok&&(await a.json()).success&&(o=!0)}catch(a){console.warn("API delete failed, falling back to hybrid storage:",a)}if(!o){const a=await k();a&&await a.deleteFlashcard(l,r)}const s=c.get().filter(a=>a.id!==r);c.set(s)}catch(o){const i=o instanceof Error?o.message:"Failed to delete flashcard";f.set(i),console.error("Failed to delete flashcard:",o);const a=c.get().filter(n=>n.id!==r);c.set(a)}finally{x.set(!1)}},setFlashcards:r=>{c.set(r)},addFlashcard:r=>{c.set([...c.get(),r])},updateFlashcard:(r,d)=>{const o=c.get().map(i=>i.id===r?{...i,...d}:i);c.set(o)},deleteFlashcardLocal:r=>{const l=c.get().filter(o=>o.id!==r);c.set(l)},setCurrentCard:r=>{$.set(r)},async forceSync(r){const d=r||w;if(d)try{const l=await k();l&&await l.forceSync(d)}catch(l){console.error("Failed to force sync:",l)}},async processQualityResponse(r,d,l=0,o){if(!(o||w)){console.warn("No user ID provided for processing quality response");return}try{x.set(!0),f.set(null);let s=!1;try{const a=await fetch(`/api/flashcards/${r}/review`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({quality:d,responseTime:l})});if(a.ok){const n=await a.json();if(n.success&&n.data?.flashcard){const t=c.get().map(h=>h.id===r?n.data.flashcard:h);c.set(t),s=!0}}}catch(a){console.warn("API quality response failed:",a)}if(!s){const n=c.get().map(u=>u.id===r?{...u,lastReviewed:new Date().toISOString(),reviewCount:(u.reviewCount||0)+1}:u);c.set(n)}}catch(s){const a=s instanceof Error?s.message:"Failed to process quality response";f.set(a),console.error("Failed to process quality response:",s)}finally{x.set(!1)}},clearError:()=>{f.set(null)}},L=({isOpen:r,onClose:d,onSuccess:l})=>{const{user:o,isAuthenticated:i}=A(),[s,a]=j.useState(!1),[n,u]=j.useState(null),[t,h]=j.useState({english:"Hello",spanish:"Hola",exampleEnglish:"Hello, how are you today?",exampleSpanish:"Hola, ¿cómo estás hoy?",category:"general",image:"",tags:"básico, saludo, común"}),m=()=>{h({english:"Hello",spanish:"Hola",exampleEnglish:"Hello, how are you today?",exampleSpanish:"Hola, ¿cómo estás hoy?",category:"general",image:"",tags:"básico, saludo, común"}),u(null)},g=v=>{const{name:p,value:y}=v.target;h(b=>({...b,[p]:y}))},E=async v=>{if(v.preventDefault(),!i||!o?.userId){u("Debes iniciar sesión para crear flashcards");return}if(!t.english.trim()||!t.spanish.trim()){u("El texto en inglés y español son obligatorios");return}a(!0),u(null);try{const p=await fetch("/api/flashcards/create",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({english:t.english.trim(),spanish:t.spanish.trim(),exampleEnglish:t.exampleEnglish.trim()||void 0,exampleSpanish:t.exampleSpanish.trim()||void 0,category:t.category,image:t.image.trim()||null,tags:t.tags.split(",").map(M=>M.trim()).filter(Boolean)})}),y=await p.json();if(!p.ok||!y.success)throw new Error(y.error||"Error al crear la flashcard");const b={id:parseInt(y.data.cardId),english:t.english.trim(),spanish:t.spanish.trim(),exampleEnglish:t.exampleEnglish.trim(),exampleSpanish:t.exampleSpanish.trim(),image:t.image.trim()||void 0,category:t.category,difficulty:1,dueDate:new Date().toISOString(),interval:1,easinessFactor:2.5,repetitions:0,lastReviewed:null,reviewCount:0};await q.saveFlashcard(b,o.userId),l?.(b),window.dispatchEvent(new CustomEvent("flashcard-created",{detail:{flashcard:b}})),m(),d()}catch(p){console.error("Failed to create flashcard:",p),u(p instanceof Error?p.message:"Error al crear la flashcard")}finally{a(!1)}},C=async()=>{if(!t.english.trim()){u("Escribe una palabra en inglés para generar ejemplos con IA");return}a(!0),u(null);try{const p=`I love ${t.english.trim()} very much.`,y=t.spanish.trim()?`Me encanta ${t.spanish.trim()} mucho.`:"Me encanta esta palabra mucho.";h(b=>({...b,exampleEnglish:p,exampleSpanish:y}))}catch(v){console.error("AI generation failed:",v),u("Error al generar ejemplos con IA")}finally{a(!1)}};return r?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"max-h-[90vh] w-full max-w-2xl overflow-y-auto rounded-2xl bg-white shadow-2xl dark:bg-gray-800",children:[e.jsxs("div",{className:"border-b border-gray-200 p-6 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Crear Nueva Flashcard"}),e.jsx("button",{onClick:d,className:"text-gray-400 transition-colors hover:text-gray-600 dark:hover:text-gray-200","aria-label":"Cerrar modal",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("p",{className:"mt-2 text-gray-600 dark:text-gray-300",children:"Crea una nueva tarjeta de vocabulario para tu colección"})]}),e.jsxs("form",{onSubmit:E,className:"space-y-6 p-6",children:[n&&e.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 p-4 dark:border-red-700 dark:bg-red-900/50",children:e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:n})}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"flashcard-english",className:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Palabra en Inglés *"}),e.jsx("input",{type:"text",name:"english",id:"flashcard-english",value:t.english,onChange:g,required:!0,className:"w-full rounded-lg border border-gray-300 px-4 py-3 transition-colors focus:border-transparent focus:ring-2 focus:ring-primary-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"Hello"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"flashcard-spanish",className:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Traducción en Español *"}),e.jsx("input",{type:"text",name:"spanish",id:"flashcard-spanish",value:t.spanish,onChange:g,required:!0,className:"w-full rounded-lg border border-gray-300 px-4 py-3 transition-colors focus:border-transparent focus:ring-2 focus:ring-primary-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"Hola"})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6 dark:border-gray-700",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Ejemplos de Uso"}),e.jsxs("button",{type:"button",onClick:C,disabled:s||!t.english.trim(),className:"flex items-center rounded-lg bg-gradient-to-r from-purple-500 to-blue-500 px-3 py-2 text-sm text-white transition-all duration-200 hover:from-purple-600 hover:to-blue-600 disabled:cursor-not-allowed disabled:from-gray-400 disabled:to-gray-500",children:[e.jsx("svg",{className:"mr-2 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),s?"Generando...":"Generar con IA"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"flashcard-example-english",className:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Ejemplo en Inglés"}),e.jsx("textarea",{name:"exampleEnglish",id:"flashcard-example-english",value:t.exampleEnglish,onChange:g,rows:2,className:"w-full resize-none rounded-lg border border-gray-300 px-4 py-3 transition-colors focus:border-transparent focus:ring-2 focus:ring-primary-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"Hello, how are you today?"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"flashcard-example-spanish",className:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Ejemplo en Español"}),e.jsx("textarea",{name:"exampleSpanish",id:"flashcard-example-spanish",value:t.exampleSpanish,onChange:g,rows:2,className:"w-full resize-none rounded-lg border border-gray-300 px-4 py-3 transition-colors focus:border-transparent focus:ring-2 focus:ring-primary-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"Hola, ¿cómo estás hoy?"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"flashcard-category",className:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Categoría"}),e.jsxs("select",{name:"category",id:"flashcard-category",value:t.category,onChange:g,className:"w-full rounded-lg border border-gray-300 px-4 py-3 transition-colors focus:border-transparent focus:ring-2 focus:ring-primary-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"family",children:"Familia"}),e.jsx("option",{value:"work",children:"Trabajo"}),e.jsx("option",{value:"travel",children:"Viajes"}),e.jsx("option",{value:"food",children:"Comida"}),e.jsx("option",{value:"emotions",children:"Emociones"}),e.jsx("option",{value:"nature",children:"Naturaleza"}),e.jsx("option",{value:"technology",children:"Tecnología"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"flashcard-tags",className:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Etiquetas (separadas por comas)"}),e.jsx("input",{type:"text",name:"tags",id:"flashcard-tags",value:t.tags,onChange:g,className:"w-full rounded-lg border border-gray-300 px-4 py-3 transition-colors focus:border-transparent focus:ring-2 focus:ring-primary-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"básico, saludo, común"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"flashcard-image",className:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"URL de Imagen (opcional)"}),e.jsx("input",{type:"url",name:"image",id:"flashcard-image",value:t.image,onChange:g,className:"w-full rounded-lg border border-gray-300 px-4 py-3 transition-colors focus:border-transparent focus:ring-2 focus:ring-primary-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"https://ejemplo.com/imagen.jpg"})]}),e.jsxs("div",{className:"flex flex-col gap-3 border-t border-gray-200 pt-6 dark:border-gray-700 sm:flex-row",children:[e.jsx("button",{type:"button",onClick:d,className:"flex-1 rounded-lg border border-gray-300 px-6 py-3 font-medium text-gray-700 transition-colors hover:bg-gray-50 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:s||!t.english.trim()||!t.spanish.trim(),className:"flex flex-1 items-center justify-center rounded-lg bg-primary-600 px-6 py-3 font-semibold text-white transition-colors hover:bg-primary-700 disabled:bg-primary-400",children:s?e.jsxs(e.Fragment,{children:[e.jsx(P,{size:"sm",color:"white",className:"mr-2"}),"Creando..."]}):"Crear Flashcard"})]})]})]})}):null},W=({className:r="",variant:d="fab",onFlashcardCreated:l})=>{const{isAuthenticated:o}=A(),[i,s]=j.useState(!1),[a,n]=j.useState(!1);O.useEffect(()=>{const m=()=>{o?s(!0):n(!0)};return window.addEventListener("open-create-modal",m),()=>{window.removeEventListener("open-create-modal",m)}},[o]);const u=()=>{o?s(!0):n(!0)},t=()=>{n(!1),s(!0)},h=m=>{s(!1),l?.(m)};return d==="fab"?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:u,className:`group fixed bottom-6 right-6 z-40 flex h-14 w-14 transform items-center justify-center rounded-full bg-primary-600 text-white shadow-lg transition-all duration-200 hover:scale-105 hover:bg-primary-700 hover:shadow-xl active:scale-95 ${r} `,"aria-label":"Crear nueva flashcard",children:[e.jsx("svg",{className:"h-6 w-6 transition-transform group-hover:rotate-90",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsxs("div",{className:"pointer-events-none absolute right-full mr-3 whitespace-nowrap rounded-lg bg-gray-900 px-3 py-2 text-sm text-white opacity-0 transition-opacity duration-200 group-hover:opacity-100",children:[o?"Crear flashcard":"Inicia sesión para crear flashcards",e.jsx("div",{className:"absolute left-full top-1/2 h-0 w-0 -translate-y-1/2 transform border-b-4 border-l-4 border-t-4 border-b-transparent border-l-gray-900 border-t-transparent"})]})]}),e.jsx(L,{isOpen:i,onClose:()=>s(!1),onSuccess:h}),e.jsx(F,{isOpen:a,onClose:()=>n(!1),initialMode:"register",onSuccess:t})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:u,className:`inline-flex items-center rounded-lg bg-primary-600 px-4 py-2 font-medium text-white transition-colors duration-200 hover:bg-primary-700 ${r} `,children:[e.jsx("svg",{className:"mr-2 h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Crear Flashcard"]}),e.jsx(L,{isOpen:i,onClose:()=>s(!1),onSuccess:h}),e.jsx(F,{isOpen:a,onClose:()=>n(!1),initialMode:"register",onSuccess:t})]})};export{W as C,R as _,q as a,c as f,B as s};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/index.DMwVkN58.js","_astro/utils.C1pdIpZs.js","_astro/react-vendor.DGywmNEQ.js","_astro/state-vendor.AbkSLUgN.js","_astro/vendor.QRJdyujs.js","_astro/hooks.Bgys84ol.js","_astro/flashcard-components.Dmu1f7E8.js"])))=>i.map(i=>d[i]);
import{j as e,u as j,r as b,R as Me}from"./react-vendor.DGywmNEQ.js";import{u as Ee}from"./hooks.Bgys84ol.js";import{_ as Le,f as me,s as Ae,a as re,C as Re}from"./flashcard-components.Dmu1f7E8.js";import{m as V,a as N,c as J}from"./state-vendor.AbkSLUgN.js";import{A as ge,S as R,T as q,a as M,u as Be,D as $}from"./utils.C1pdIpZs.js";import"./vendor.QRJdyujs.js";import"./Header.astro_astro_type_script_index_0_lang.D70yTJYG.js";const W=r=>{switch(r){case"sm":return"w-8 h-8 text-sm";case"md":return"w-10 h-10 text-base";case"lg":return"w-12 h-12 text-lg";default:return"w-10 h-10 text-base"}},mt=({size:r="md",variant:t="button",className:s=""})=>{const{theme:o,actualTheme:n,toggleTheme:a,isDark:i,mounted:c}=Ee();if(!c)return e.jsx("div",{className:`${W(r)} animate-pulse rounded-lg bg-gray-200 dark:bg-gray-700`});const l=()=>o==="auto"?"ðŸŒ“":i?"ðŸŒ™":"â˜€ï¸",m=()=>o==="auto"?`Tema automÃ¡tico (${n==="dark"?"oscuro":"claro"})`:`Cambiar a tema ${i?"claro":"oscuro"}`;return t==="minimal"?e.jsx("button",{onClick:a,className:` ${W(r)} flex items-center justify-center rounded-full bg-gray-100 transition-colors duration-200 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 dark:bg-gray-800 dark:hover:bg-gray-700 ${s} `,"aria-label":m(),title:m(),suppressHydrationWarning:!0,children:e.jsx("span",{className:"text-lg",role:"img","aria-hidden":"true",children:l()})}):t==="icon"?e.jsx("button",{onClick:a,className:` ${W(r)} flex items-center justify-center rounded-lg border border-gray-300 bg-gray-100 transition-all duration-200 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 dark:border-gray-600 dark:bg-gray-800 dark:hover:bg-gray-700 ${s} `,"aria-label":m(),title:m(),suppressHydrationWarning:!0,children:e.jsx("span",{className:"text-xl",role:"img","aria-hidden":"true",children:l()})}):e.jsxs("button",{onClick:a,className:` ${W(r)} flex items-center justify-center gap-2 rounded-lg border border-gray-300 bg-gray-100 px-3 py-2 text-gray-700 transition-all duration-200 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700 ${s} `,"aria-label":m(),title:m(),suppressHydrationWarning:!0,children:[e.jsx("span",{className:"text-lg",role:"img","aria-hidden":"true",children:l()}),e.jsx("span",{className:"text-sm font-medium",children:o==="auto"?"Auto":i?"Oscuro":"Claro"})]})};let D=null,ae=null,xe=null,z=null;const le=async()=>{if(typeof window>"u"&&!D)try{const r=await Le(()=>import("./index.DMwVkN58.js"),__vite__mapDeps([0,1,2,3,4,5,6]));D=r.flashcardsService,ae=r.studySessionsService,xe=r.studyStatisticsService,z=r.syncService}catch(r){console.warn("MongoDB services not available:",r)}},Ie={cacheExpiryMs:1800*1e3,maxRetryAttempts:3,syncIntervalMs:300*1e3,enableBackgroundSync:!0,conflictResolutionStrategy:"merge"},A={flashcards:"linguaflip_flashcards_cache",studySessions:"linguaflip_sessions_cache",progressStats:"linguaflip_progress_cache",studyProfiles:"linguaflip_profiles_cache",syncStatus:"linguaflip_sync_status",lastSync:"linguaflip_last_sync"};class ye{constructor(t={}){this.syncStatusStore=V({isOnline:typeof navigator<"u"?navigator.onLine:!0,lastSyncTimestamp:null,pendingChanges:0,syncInProgress:!1,lastSyncError:null,retryCount:0}),this.cacheStores={flashcards:new Map,studySessions:new Map,progressStats:new Map,studyProfiles:new Map},this.syncIntervalId=null,this.retryTimeouts=new Map,this.config={...Ie,...t},this.initialize()}initialize(){this.loadCacheFromLocalStorage(),this.setupNetworkListeners(),this.setupPeriodicSync(),this.loadSyncStatus()}loadCacheFromLocalStorage(){if(!(typeof window>"u"||typeof localStorage>"u"))try{const t=localStorage.getItem(A.flashcards);if(t){const a=JSON.parse(t);this.cacheStores.flashcards.set("default",{data:a.data,timestamp:new Date(a.timestamp),version:a.version||1,isDirty:a.isDirty||!1})}const s=localStorage.getItem(A.studySessions);if(s){const a=JSON.parse(s);this.cacheStores.studySessions.set("default",{data:a.data,timestamp:new Date(a.timestamp),version:a.version||1,isDirty:a.isDirty||!1})}const o=localStorage.getItem(A.progressStats);if(o){const a=JSON.parse(o);this.cacheStores.progressStats.set("default",{data:a.data,timestamp:new Date(a.timestamp),version:a.version||1,isDirty:a.isDirty||!1})}const n=localStorage.getItem(A.studyProfiles);if(n){const a=JSON.parse(n);this.cacheStores.studyProfiles.set("default",{data:a.data,timestamp:new Date(a.timestamp),version:a.version||1,isDirty:a.isDirty||!1})}}catch(t){console.error("Failed to load cache from localStorage:",t)}}loadSyncStatus(){if(!(typeof window>"u"||typeof localStorage>"u"))try{const t=localStorage.getItem(A.syncStatus);if(t){const s=JSON.parse(t);this.syncStatusStore.set({...this.syncStatusStore.get(),lastSyncTimestamp:s.lastSyncTimestamp?new Date(s.lastSyncTimestamp):null,pendingChanges:s.pendingChanges||0,lastSyncError:s.lastSyncError||null,retryCount:s.retryCount||0})}}catch(t){console.error("Failed to load sync status:",t)}}setupNetworkListeners(){typeof window>"u"||(window.addEventListener("online",()=>{this.syncStatusStore.setKey("isOnline",!0),this.performSync()}),window.addEventListener("offline",()=>{this.syncStatusStore.setKey("isOnline",!1)}))}setupPeriodicSync(){typeof window>"u"||this.config.enableBackgroundSync&&(this.syncIntervalId=window.setInterval(()=>{this.syncStatusStore.get().isOnline&&this.performSync()},this.config.syncIntervalMs))}async getFlashcards(t,s=!1){const o=t;if(!s){const a=this.cacheStores.flashcards.get(o);if(a&&!this.isCacheExpired(a))return a.data}if(D)try{const a=await D.getDueFlashcards(t,{limit:1e3,includeSuspended:!0});if(a.success&&a.data){const i=this.convertMongoFlashcardsToLocal(a.data);return this.updateCache("flashcards",o,i,!1),i}}catch(a){console.error("Failed to fetch flashcards from MongoDB:",a)}else if(await le(),D)try{const a=await D.getDueFlashcards(t,{limit:1e3,includeSuspended:!0});if(a.success&&a.data){const i=this.convertMongoFlashcardsToLocal(a.data);return this.updateCache("flashcards",o,i,!1),i}}catch(a){console.error("Failed to fetch flashcards from MongoDB after loading services:",a)}return this.cacheStores.flashcards.get(o)?.data||[]}async saveFlashcard(t,s){const o=t,a=this.cacheStores.flashcards.get(o)?.data||[],i=s.id?a.map(c=>c.id===s.id?s:c):[...a,s];if(this.updateCache("flashcards",o,i,!0),this.syncStatusStore.get().isOnline&&(D||await le(),D))try{const c=this.convertLocalFlashcardToMongo(s,t);if(s.id)await D.updateFlashcard(s.id.toString(),c,t);else{const l=await D.createFlashcard(c,t);if(l.success&&l.data){const m={...s,id:parseInt(l.data.cardId)},d=i.map(h=>h===s?m:h);this.updateCache("flashcards",o,d,!1)}}}catch(c){console.error("Failed to sync flashcard to MongoDB:",c),this.scheduleRetry("flashcard",t,s)}}async deleteFlashcard(t,s){const o=t,i=(this.cacheStores.flashcards.get(o)?.data||[]).filter(c=>c.id!==s);if(this.updateCache("flashcards",o,i,!0),this.syncStatusStore.get().isOnline)try{await D.deleteFlashcard(s.toString(),t)}catch(c){console.error("Failed to delete flashcard from MongoDB:",c),this.scheduleRetry("delete_flashcard",t,{flashcardId:s})}}async getStudySessions(t,s=!1){const o=t;if(!s){const a=this.cacheStores.studySessions.get(o);if(a&&!this.isCacheExpired(a))return a.data}try{const a=await ae.getUserStudySessions(t,{limit:100,sortBy:"startTime",sortOrder:-1});if(a.success&&a.data){const i=this.convertMongoSessionsToLocal(a.data);return this.updateCache("studySessions",o,i,!1),i}}catch(a){console.error("Failed to fetch study sessions from MongoDB:",a)}return this.cacheStores.studySessions.get(o)?.data||[]}async saveStudySession(t,s){const o=t,i=[...this.cacheStores.studySessions.get(o)?.data||[],s];if(this.updateCache("studySessions",o,i,!0),this.syncStatusStore.get().isOnline)try{const c=this.convertLocalSessionToMongo(s,t);await ae.createStudySession(c,t)}catch(c){console.error("Failed to sync study session to MongoDB:",c),this.scheduleRetry("study_session",t,s)}}async getProgressStats(t,s=!1){const o=t;if(!s){const a=this.cacheStores.progressStats.get(o);if(a&&!this.isCacheExpired(a))return a.data}try{const a=await xe.getStudyStatisticsByDate(t,new Date,"daily");if(a.success&&a.data){const i=this.convertMongoStatsToLocal(a.data);return this.updateCache("progressStats",o,i,!1),i}}catch(a){console.error("Failed to fetch progress stats from MongoDB:",a)}return this.cacheStores.progressStats.get(o)?.data||this.getDefaultProgressStats()}async performSync(t){if(!this.syncStatusStore.get().syncInProgress){this.syncStatusStore.setKey("syncInProgress",!0),this.syncStatusStore.setKey("lastSyncError",null);try{await this.syncDirtyData(t);const s=new Date;this.syncStatusStore.setKey("lastSyncTimestamp",s),this.syncStatusStore.setKey("pendingChanges",0),this.saveSyncStatus()}catch(s){const o=s instanceof Error?s.message:"Unknown sync error";this.syncStatusStore.setKey("lastSyncError",o),console.error("Sync failed:",s)}finally{this.syncStatusStore.setKey("syncInProgress",!1)}}}async syncDirtyData(t){const s=t?[t]:this.getUsersWithDirtyData();for(const o of s)await this.syncUserData(o)}async syncUserData(t){const s=this.cacheStores.flashcards.get(t);s?.isDirty&&await this.syncFlashcards(t,s.data);const o=this.cacheStores.studySessions.get(t);o?.isDirty&&await this.syncStudySessions(t,o.data)}async syncFlashcards(t,s){try{const o=s.map(a=>this.convertLocalFlashcardToMongo(a,t));if((await z.syncFromLocal(t,{flashcards:o},{resolveConflicts:this.config.conflictResolutionStrategy==="manual"?"merge":this.config.conflictResolutionStrategy,skipExisting:!1,batchSize:50})).success){const a=this.cacheStores.flashcards.get(t);a&&(a.isDirty=!1,this.saveCacheToLocalStorage("flashcards",t,a))}}catch(o){throw console.error("Failed to sync flashcards:",o),o}}async syncStudySessions(t,s){try{const o=s.map(a=>this.convertLocalSessionToMongo(a,t));if((await z.syncFromLocal(t,{studySessions:o},{resolveConflicts:this.config.conflictResolutionStrategy==="manual"?"merge":this.config.conflictResolutionStrategy,skipExisting:!1,batchSize:50})).success){const a=this.cacheStores.studySessions.get(t);a&&(a.isDirty=!1,this.saveCacheToLocalStorage("studySessions",t,a))}}catch(o){throw console.error("Failed to sync study sessions:",o),o}}async migrateLocalStorageToMongoDB(t){const s={success:!0,migratedItems:0,skippedItems:0,errors:[]};try{const o=this.cacheStores.flashcards.get(t);if(o?.data.length){const a=o.data.map(c=>this.convertLocalFlashcardToMongo(c,t)),i=await z.migrateUserData(t,{flashcards:a});i.success&&i.data&&(s.migratedItems+=i.data.migratedItems.flashcards,s.errors.push(...i.data.errors))}const n=this.cacheStores.studySessions.get(t);if(n?.data.length){const a=n.data.map(c=>this.convertLocalSessionToMongo(c,t)),i=await z.migrateUserData(t,{studySessions:a});i.success&&i.data&&(s.migratedItems+=i.data.migratedItems.studySessions,s.errors.push(...i.data.errors))}s.errors.length>0&&(s.success=!1)}catch(o){s.success=!1,s.errors.push(o instanceof Error?o.message:"Migration failed")}return s}updateCache(t,s,o,n){const a={data:o,timestamp:new Date,version:1,isDirty:n};switch(t){case"flashcards":this.cacheStores.flashcards.set(s,a);break;case"studySessions":this.cacheStores.studySessions.set(s,a);break;case"progressStats":this.cacheStores.progressStats.set(s,a);break;case"studyProfiles":this.cacheStores.studyProfiles.set(s,a);break}if(this.saveCacheToLocalStorage(t,s,a),n){const i=this.syncStatusStore.get();this.syncStatusStore.setKey("pendingChanges",i.pendingChanges+1)}}saveCacheToLocalStorage(t,s,o){if(!(typeof window>"u"||typeof localStorage>"u"))try{const n=A[t],a={data:o.data,timestamp:o.timestamp.toISOString(),version:o.version,isDirty:o.isDirty};localStorage.setItem(n,JSON.stringify(a))}catch(n){console.error("Failed to save cache to localStorage:",n)}}saveSyncStatus(){if(!(typeof window>"u"||typeof localStorage>"u"))try{const t=this.syncStatusStore.get(),s={lastSyncTimestamp:t.lastSyncTimestamp?.toISOString(),pendingChanges:t.pendingChanges,lastSyncError:t.lastSyncError,retryCount:t.retryCount};localStorage.setItem(A.syncStatus,JSON.stringify(s))}catch(t){console.error("Failed to save sync status:",t)}}isCacheExpired(t){return new Date().getTime()-t.timestamp.getTime()>this.config.cacheExpiryMs}scheduleRetry(t,s,o){if(typeof window>"u")return;const n=`${t}_${s}_${Date.now()}`,a=window.setTimeout(async()=>{try{await this.performRetry(t,s,o)}finally{this.retryTimeouts.delete(n)}},Math.pow(2,this.syncStatusStore.get().retryCount)*1e3);this.retryTimeouts.set(n,a);const i=this.syncStatusStore.get();this.syncStatusStore.setKey("retryCount",i.retryCount+1)}async performRetry(t,s,o){if(this.syncStatusStore.get().retryCount>=this.config.maxRetryAttempts){console.error(`Max retry attempts reached for ${t}`);return}try{switch(t){case"flashcard":await this.saveFlashcard(s,o);break;case"study_session":await this.saveStudySession(s,o);break;case"delete_flashcard":await this.deleteFlashcard(s,o.flashcardId);break}this.syncStatusStore.setKey("retryCount",0)}catch(a){console.error(`Retry failed for ${t}:`,a),this.scheduleRetry(t,s,o)}}getUsersWithDirtyData(){const t=new Set;for(const[s,o]of this.cacheStores.flashcards.entries())o.isDirty&&t.add(s);for(const[s,o]of this.cacheStores.studySessions.entries())o.isDirty&&t.add(s);return Array.from(t)}convertMongoFlashcardsToLocal(t){return t.map(s=>({id:parseInt(s.cardId),english:s.front,spanish:s.back,exampleEnglish:s.exampleFront,exampleSpanish:s.exampleBack,image:s.image??s.imageUrl??null,dueDate:s.sm2.nextReviewDate.toISOString().split("T")[0],interval:s.sm2.interval,easinessFactor:s.sm2.easeFactor,repetitions:s.sm2.repetitions,lastReviewed:s.sm2.lastReviewed?.toISOString()||null}))}convertLocalFlashcardToMongo(t,s){return{cardId:t.id.toString(),userId:s,front:t.english,back:t.spanish,exampleFront:t.exampleEnglish,exampleBack:t.exampleSpanish,image:t.image,category:"general",difficulty:"medium",tags:[],sm2:{repetitions:t.repetitions,easeFactor:t.easinessFactor,interval:t.interval,nextReviewDate:new Date(t.dueDate),lastReviewed:t.lastReviewed?new Date(t.lastReviewed):null,qualityResponses:[],totalReviews:0,isSuspended:!1,suspensionReason:null},statistics:{timesCorrect:0,timesIncorrect:0,averageResponseTime:0,lastDifficulty:"medium"}}}convertMongoSessionsToLocal(t){return t.map(s=>({id:s.sessionId,date:s.startTime instanceof Date?s.startTime.toISOString():new Date(s.startTime).toISOString(),cardsReviewed:typeof s.cardsReviewed=="number"?s.cardsReviewed:Array.isArray(s.cardsStudied)?s.cardsStudied.length:0,correctAnswers:s.correctAnswers,totalTime:typeof s.duration=="number"?s.duration:typeof s.totalTime=="number"?s.totalTime:0,averageResponseTime:s.averageResponseTime}))}convertLocalSessionToMongo(t,s){return{sessionId:t.id,userId:s,date:t.date,cardsReviewed:t.cardsReviewed,correctAnswers:t.correctAnswers,totalTime:t.totalTime,averageResponseTime:t.averageResponseTime,mode:"mixed",difficulty:"medium",profileId:"default"}}convertMongoStatsToLocal(t){return{totalCards:Number(t.totalCards)||0,cardsMastered:Number(t.matureCards)||0,cardsInProgress:Number(t.learningCards)||0,cardsNew:Number(t.newCards)||0,currentStreak:0,longestStreak:0,totalStudyTime:Number(t.totalStudyTime)||0,averageAccuracy:Number(t.averageAccuracy)||0,studySessionsToday:0,studySessionsThisWeek:0,studySessionsThisMonth:0}}getDefaultProgressStats(){return{totalCards:0,cardsMastered:0,cardsInProgress:0,cardsNew:0,currentStreak:0,longestStreak:0,totalStudyTime:0,averageAccuracy:0,studySessionsToday:0,studySessionsThisWeek:0,studySessionsThisMonth:0}}getSyncStatus(){return this.syncStatusStore.get()}getSyncStatusStore(){return this.syncStatusStore}async forceSync(t){await this.performSync(t)}clearCache(){this.cacheStores.flashcards.clear(),this.cacheStores.studySessions.clear(),this.cacheStores.progressStats.clear(),this.cacheStores.studyProfiles.clear(),typeof window<"u"&&typeof localStorage<"u"&&Object.values(A).forEach(t=>{localStorage.removeItem(t)})}destroy(){this.syncIntervalId&&clearInterval(this.syncIntervalId),this.retryTimeouts.forEach(t=>{clearTimeout(t)}),this.retryTimeouts.clear()}}const L=new ye;function pe(){return j(L.getSyncStatusStore())}const gt=Object.freeze(Object.defineProperty({__proto__:null,HybridStorage:ye,hybridStorage:L,useSyncStatus:pe},Symbol.toStringTag,{value:"Module"})),E=V({isActive:!1,isPaused:!1,startTime:null,pauseTime:null,totalPausedTime:0,cardsStudied:0,correctAnswers:0,currentBreakTime:0,nextBreakTime:0}),O=N([]),te=N(null),fe=N({totalCards:0,cardsMastered:0,cardsInProgress:0,cardsNew:0,currentStreak:0,longestStreak:0,totalStudyTime:0,averageAccuracy:0,studySessionsToday:0,studySessionsThisWeek:0,studySessionsThisMonth:0}),H=N(!1),_=N(null);L.getSyncStatusStore();let G=null;const se={async loadStudySessions(r){const t=r||G;if(!t){console.warn("No user ID provided for loading study sessions");return}try{H.set(!0),_.set(null);const s=await L.getStudySessions(t);O.set(s)}catch(s){const o=s instanceof Error?s.message:"Failed to load study sessions";_.set(o),console.error("Failed to load study sessions:",s)}finally{H.set(!1)}},async loadProgressStats(r){const t=r||G;if(!t){console.warn("No user ID provided for loading progress stats");return}try{H.set(!0),_.set(null);const s=await L.getProgressStats(t);fe.set(s)}catch(s){const o=s instanceof Error?s.message:"Failed to load progress stats";_.set(o),console.error("Failed to load progress stats:",s)}finally{H.set(!1)}},startSession:()=>{const r=new Date;E.set({isActive:!0,isPaused:!1,startTime:r,pauseTime:null,totalPausedTime:0,cardsStudied:0,correctAnswers:0,currentBreakTime:0,nextBreakTime:0})},pauseSession:()=>{const r=E.get();if(r.isActive&&!r.isPaused){const t=new Date;E.set({...r,isPaused:!0,pauseTime:t})}},resumeSession:()=>{const r=E.get();if(r.isActive&&r.isPaused&&r.pauseTime){const t=Date.now()-r.pauseTime.getTime();E.set({...r,isPaused:!1,pauseTime:null,totalPausedTime:r.totalPausedTime+Math.floor(t/1e3)})}},endSession:async r=>{const t=E.get();if(t.isActive){const s=r||G,o={id:`session_${Date.now()}`,date:new Date().toISOString(),cardsReviewed:t.cardsStudied,correctAnswers:t.correctAnswers,totalTime:t.startTime?Math.floor((Date.now()-t.startTime.getTime()-t.totalPausedTime*1e3)/1e3):0,averageResponseTime:0};if(O.set([...O.get(),o]),s)try{await L.saveStudySession(s,o)}catch(n){console.error("Failed to save study session to MongoDB:",n)}E.set({isActive:!1,isPaused:!1,startTime:null,pauseTime:null,totalPausedTime:0,cardsStudied:0,correctAnswers:0,currentBreakTime:0,nextBreakTime:0})}},recordAnswer:r=>{const t=E.get();E.set({...t,cardsStudied:t.cardsStudied+1,correctAnswers:t.correctAnswers+(r?1:0)})},async forceSync(r){const t=r||G;if(t)try{await L.forceSync(t)}catch(s){console.error("Failed to force sync study data:",s)}},clearError:()=>{_.set(null)}},xt={setCurrentProfile:r=>{te.set(r)},updateProfile:r=>{const t=te.get();t&&te.set({...t,...r,updatedAt:new Date().toISOString()})}},be=N(null),ve=N(null),Se=N(null),B=V({stats:!1,activity:!1,progress:!1}),F=V({stats:null,activity:null,progress:null});J(B,r=>r.stats||r.activity||r.progress);J(F,r=>Object.values(r).filter(Boolean));const Fe=async()=>{B.setKey("stats",!0),F.setKey("stats",null);try{const t=await(await fetch("/api/dashboard/stats")).json();if(t.success)be.set(t.data);else throw new Error(t.error||"Failed to fetch dashboard stats")}catch(r){console.error("Error fetching dashboard stats:",r),F.setKey("stats",r instanceof Error?r.message:"Unknown error")}finally{B.setKey("stats",!1)}},Pe=async(r=10,t=0)=>{B.setKey("activity",!0),F.setKey("activity",null);try{const o=await(await fetch(`/api/dashboard/activity?limit=${r}&offset=${t}`)).json();if(o.success)ve.set(o.data);else throw new Error(o.error||"Failed to fetch dashboard activity")}catch(s){console.error("Error fetching dashboard activity:",s),F.setKey("activity",s instanceof Error?s.message:"Unknown error")}finally{B.setKey("activity",!1)}},Oe=async(r=30,t="daily")=>{B.setKey("progress",!0),F.setKey("progress",null);try{const o=await(await fetch(`/api/dashboard/progress?days=${r}&type=${t}`)).json();if(o.success)Se.set(o.data);else throw new Error(o.error||"Failed to fetch dashboard progress")}catch(s){console.error("Error fetching dashboard progress:",s),F.setKey("progress",s instanceof Error?s.message:"Unknown error")}finally{B.setKey("progress",!1)}},$e=async()=>{await Promise.all([Fe(),Pe(5),Oe(30,"daily")])},_e=({flashcards:r,progressStats:t,studyHistory:s,dashboardStats:o,loading:n=!1})=>{const i=(()=>{if(o)return{totalCards:o.totalCards,masteredCards:o.masteredCards,currentStreak:o.currentStreak,todayStudyTime:o.todayStudyTime};const l=new Date().toDateString(),d=s.filter(y=>new Date(y.date).toDateString()===l).reduce((y,g)=>y+g.totalTime,0),h=r.filter(y=>y.easinessFactor>=2.5&&y.repetitions>=3).length;return{totalCards:r.length,masteredCards:h,currentStreak:t.currentStreak,todayStudyTime:d}})(),c=[{title:"Total de Tarjetas",value:i.totalCards,icon:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})}),color:"primary",bgColor:"bg-primary-100 dark:bg-primary-900",textColor:"text-primary-600 dark:text-primary-400"},{title:"Tarjetas Dominadas",value:i.masteredCards,icon:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"})}),color:"success",bgColor:"bg-success-100 dark:bg-success-900",textColor:"text-success-600 dark:text-success-400"},{title:"Racha Actual",value:i.currentStreak,icon:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})}),color:"accent",bgColor:"bg-accent-100 dark:bg-accent-900",textColor:"text-accent-600 dark:text-accent-400"},{title:"Tiempo Hoy",value:`${i.todayStudyTime}m`,icon:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),color:"secondary",bgColor:"bg-secondary-100 dark:bg-secondary-900",textColor:"text-secondary-600 dark:text-secondary-400"}];return e.jsx("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-4",children:c.map((l,m)=>e.jsx("div",{className:"rounded-xl border border-neutral-200 bg-white p-6 shadow-lg transition-shadow duration-200 hover:shadow-xl dark:border-gray-600 dark:bg-gray-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-neutral-600 dark:text-neutral-300",children:l.title}),n?e.jsx("div",{className:"h-8 w-16 animate-pulse rounded bg-gray-200 dark:bg-gray-700"}):e.jsx("p",{className:"text-2xl font-bold text-neutral-900 dark:text-neutral-100",children:l.value})]}),e.jsx("div",{className:`h-12 w-12 ${l.bgColor} flex items-center justify-center rounded-lg`,children:e.jsx("div",{className:l.textColor,children:l.icon})})]})},m))})},ze=({studySessions:r,months:t=12})=>{const s=u=>{const f=[],v=new Date;for(let w=u*30;w>=0;w--){const P=new Date(v);P.setDate(v.getDate()-w),f.push(P.toISOString().split("T")[0])}return f},o=u=>{const f={};return u.forEach(v=>{const w=v.date;f[w]=(f[w]||0)+v.totalTime}),f},n=u=>u===0?0:u<15?1:u<30?2:u<60?3:4,a=u=>["bg-gray-100","bg-green-200","bg-green-300","bg-green-400","bg-green-500"][u],i=()=>{const u=[],f=new Date;for(let v=t-1;v>=0;v--){const w=new Date(f.getFullYear(),f.getMonth()-v,1);u.push(w.toLocaleDateString("en-US",{month:"short"}))}return u},c=()=>["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],l=s(t),m=o(r),d=i(),h=c(),y=[];let g=[];l.forEach((u,f)=>{const v=new Date(u).getDay();g.push(u),(v===6||f===l.length-1)&&(y.push([...g]),g=[])});const S=Object.values(m).reduce((u,f)=>u+f,0),x=Object.keys(m).length,p=x>0?S/x:0;return e.jsxs("div",{className:"rounded-xl bg-white p-6 shadow-lg",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Study Consistency"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Your study activity over the past ",t," months"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[Math.round(S),"m"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Total study time"})]})]}),e.jsxs("div",{className:"mb-6 grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"rounded-lg bg-blue-50 p-3 text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-blue-600",children:x}),e.jsx("div",{className:"text-xs text-gray-600",children:"Study Days"})]}),e.jsxs("div",{className:"rounded-lg bg-green-50 p-3 text-center",children:[e.jsxs("div",{className:"text-lg font-semibold text-green-600",children:[Math.round(p),"m"]}),e.jsx("div",{className:"text-xs text-gray-600",children:"Daily Average"})]}),e.jsxs("div",{className:"rounded-lg bg-purple-50 p-3 text-center",children:[e.jsxs("div",{className:"text-lg font-semibold text-purple-600",children:[x>0?Math.round(x/(t*30)*100):0,"%"]}),e.jsx("div",{className:"text-xs text-gray-600",children:"Consistency"})]})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"inline-flex",children:[e.jsx("div",{className:"flex flex-col justify-around pr-2 text-xs text-gray-500",children:h.map((u,f)=>e.jsx("div",{className:"flex h-3 items-center",children:f%2===0?u:""},u))}),e.jsx("div",{className:"flex space-x-1",children:y.map((u,f)=>e.jsx("div",{className:"flex flex-col space-y-1",children:u.map(v=>{const w=m[v]||0,P=n(w),Z=a(P);return e.jsx("div",{className:`h-3 w-3 rounded-sm ${Z} cursor-pointer border border-gray-200 transition-all hover:ring-2 hover:ring-blue-300`,title:`${v}: ${w>0?`${w} minutes`:"No study"}`},v)})},f))})]}),e.jsx("div",{className:"mt-2 flex pl-8",children:d.map(u=>e.jsx("div",{className:"text-xs text-gray-500",style:{width:`${100/d.length}%`},children:u},u))})]}),e.jsxs("div",{className:"mt-6 flex items-center justify-between border-t border-gray-200 pt-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Less"}),e.jsx("div",{className:"flex space-x-1",children:[0,1,2,3,4].map(u=>e.jsx("div",{className:`h-3 w-3 rounded-sm ${a(u)} border border-gray-200`,title:u===0?"No study":u===1?"< 15 min":u===2?"15-30 min":u===3?"30-60 min":"> 60 min"},u))}),e.jsx("div",{className:"text-sm text-gray-600",children:"More"})]}),e.jsxs("div",{className:"mt-6 rounded-lg bg-gray-50 p-4",children:[e.jsx("h4",{className:"mb-2 text-sm font-semibold text-gray-900",children:"Study Insights"}),e.jsx("div",{className:"space-y-1 text-sm text-gray-600",children:x===0?e.jsx("p",{children:"Start studying to see your consistency pattern!"}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["You've studied on ",e.jsx("strong",{children:x})," days in the past ",t," months."]}),e.jsxs("p",{children:["Your average daily study time is"," ",e.jsxs("strong",{children:[Math.round(p)," minutes"]}),"."]}),e.jsx("p",{children:p<15?"Consider increasing your daily study time for better retention.":p>60?"Great job maintaining consistent long study sessions!":"Your study time looks balanced and consistent."})]})})]})]})},Ue=({studyHistory:r,maxItems:t=5})=>{const s=r.sort((a,i)=>new Date(i.date).getTime()-new Date(a.date).getTime()).slice(0,t),o=a=>{const i=new Date(a),c=new Date,l=new Date(c);return l.setDate(l.getDate()-1),i.toDateString()===c.toDateString()?"Hoy":i.toDateString()===l.toDateString()?"Ayer":i.toLocaleDateString("es-ES",{day:"numeric",month:"short"})},n=a=>a>=80?"text-success-600 dark:text-success-400":a>=60?"text-warning-600 dark:text-warning-400":"text-error-600 dark:text-error-400";return e.jsxs("div",{className:"rounded-xl border border-neutral-200 bg-white p-6 shadow-lg dark:border-gray-600 dark:bg-gray-800",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold text-neutral-900 dark:text-neutral-100",children:"Actividad Reciente"}),s.length===0?e.jsxs("div",{className:"py-8 text-center",children:[e.jsx("div",{className:"mb-2 text-neutral-500 dark:text-neutral-400",children:e.jsx("svg",{className:"mx-auto mb-4 h-12 w-12 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})})}),e.jsx("p",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:"No hay sesiones de estudio recientes"}),e.jsx("a",{href:"/study",className:"mt-4 inline-flex items-center rounded-lg bg-primary-600 px-4 py-2 text-sm font-medium text-white transition-colors duration-200 hover:bg-primary-700",children:"Comenzar a Estudiar"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:s.map((a,i)=>{const c=Math.round(a.correctAnswers/a.cardsReviewed*100);return e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-primary-100 dark:bg-primary-900",children:e.jsx("svg",{className:"h-4 w-4 text-primary-600 dark:text-primary-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-neutral-900 dark:text-neutral-100",children:[a.cardsReviewed," tarjetas estudiadas"]}),e.jsx("p",{className:"text-xs text-neutral-600 dark:text-neutral-400",children:o(a.date)})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-medium text-neutral-900 dark:text-neutral-100",children:[a.totalTime,"m"]}),e.jsxs("p",{className:`text-xs ${n(c)}`,children:[c,"% precisiÃ³n"]})]})]},a.id||i)})}),e.jsx("div",{className:"mt-4 border-t border-neutral-200 pt-4 dark:border-gray-600",children:e.jsxs("a",{href:"/study",className:"flex items-center gap-2 text-sm font-medium text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300",children:["Ver todas las sesiones",e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})]})})]})]})},Ke=({studyHistory:r})=>{const s=(()=>{const n={easy:{correct:0,total:0},medium:{correct:0,total:0},hard:{correct:0,total:0}};return r.forEach(a=>{const i=a.cardsReviewed,c=a.correctAnswers,l=Math.floor(i*.4),m=Math.floor(i*.4),d=i-l-m,h=Math.floor(c*.5),y=Math.floor(c*.35),g=c-h-y;n.easy.correct+=h,n.easy.total+=l,n.medium.correct+=y,n.medium.total+=m,n.hard.correct+=g,n.hard.total+=d}),{easy:n.easy.total>0?Math.round(n.easy.correct/n.easy.total*100):0,medium:n.medium.total>0?Math.round(n.medium.correct/n.medium.total*100):0,hard:n.hard.total>0?Math.round(n.hard.correct/n.hard.total*100):0}})(),o=[{label:"FÃ¡cil",percentage:s.easy,color:"bg-success-500",bgColor:"bg-success-200"},{label:"Medio",percentage:s.medium,color:"bg-warning-500",bgColor:"bg-warning-200"},{label:"DifÃ­cil",percentage:s.hard,color:"bg-error-500",bgColor:"bg-error-200"}];return e.jsxs("div",{className:"rounded-xl border border-neutral-200 bg-white p-6 shadow-lg dark:border-gray-600 dark:bg-gray-800",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold text-neutral-900 dark:text-neutral-100",children:"PrecisiÃ³n por Dificultad"}),r.length===0?e.jsxs("div",{className:"py-8 text-center",children:[e.jsx("div",{className:"mb-2 text-neutral-500 dark:text-neutral-400",children:e.jsx("svg",{className:"mx-auto mb-4 h-12 w-12 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),e.jsx("p",{className:"text-sm text-neutral-500 dark:text-neutral-400",children:"Comienza a estudiar para ver tus estadÃ­sticas de precisiÃ³n"})]}):e.jsx("div",{className:"space-y-4",children:o.map((n,a)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"min-w-[60px] text-sm text-neutral-600 dark:text-neutral-300",children:n.label}),e.jsx("div",{className:"mx-4 flex-1",children:e.jsx("div",{className:`w-full ${n.bgColor} h-2 rounded-full`,children:e.jsx("div",{className:`${n.color} h-2 rounded-full transition-all duration-500 ease-out`,style:{width:`${n.percentage}%`}})})}),e.jsxs("span",{className:"min-w-[45px] text-right text-sm font-medium text-neutral-900 dark:text-neutral-100",children:[n.percentage,"%"]})]},a))}),r.length>0&&e.jsx("div",{className:"mt-6 border-t border-neutral-200 pt-4 dark:border-gray-600",children:e.jsxs("div",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:[e.jsxs("p",{children:["Basado en ",r.length," sesiones de estudio"]}),e.jsxs("p",{className:"mt-1",children:["Total de tarjetas revisadas:"," ",r.reduce((n,a)=>n+a.cardsReviewed,0)]})]})})]})},We=({progressStats:r,studyHistory:t})=>{const s=()=>{const h=new Date().toDateString(),y=t.filter(x=>new Date(x.date).toDateString()===h),g=y.reduce((x,p)=>x+p.cardsReviewed,0),S=y.reduce((x,p)=>x+p.totalTime,0);return{cardsToday:g,timeToday:S}},{cardsToday:o,timeToday:n}=s(),a=20,i=45,c=Math.min(o/a*100,100),l=Math.min(n/i*100,100),m=({percentage:h,color:y,size:g=48})=>{const S=(g-4)/2,x=S*2*Math.PI,p=`${h/100*x} ${x}`;return e.jsxs("div",{className:"relative",style:{width:g,height:g},children:[e.jsxs("svg",{width:g,height:g,className:"-rotate-90 transform",children:[e.jsx("circle",{cx:g/2,cy:g/2,r:S,fill:"none",stroke:"#e5e7eb",strokeWidth:"2",className:"dark:stroke-gray-600"}),e.jsx("circle",{cx:g/2,cy:g/2,r:S,fill:"none",stroke:y,strokeWidth:"2",strokeDasharray:p,strokeLinecap:"round",className:"transition-all duration-500 ease-out"})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:"text-xs font-medium text-neutral-900 dark:text-neutral-100",children:[Math.round(h),"%"]})})]})},d=[{title:"Tarjetas Diarias",current:o,target:a,progress:c,color:"#3b82f6",unit:"tarjetas",icon:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})},{title:"Tiempo de Estudio",current:n,target:i,progress:l,color:"#10b981",unit:"minutos",icon:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}];return e.jsxs("div",{className:"rounded-xl border border-neutral-200 bg-white p-6 shadow-lg dark:border-gray-600 dark:bg-gray-800",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold text-neutral-900 dark:text-neutral-100",children:"Metas de Estudio"}),e.jsx("div",{className:"space-y-6",children:d.map((h,y)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-gray-100 dark:bg-gray-700",children:e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:h.icon})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-neutral-900 dark:text-neutral-100",children:h.title}),e.jsxs("p",{className:"text-xs text-neutral-600 dark:text-neutral-400",children:[h.current," de ",h.target," ",h.unit]})]})]}),e.jsx(m,{percentage:h.progress,color:h.color})]},y))}),e.jsx("div",{className:"mt-6 border-t border-neutral-200 pt-4 dark:border-gray-600",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-neutral-900 dark:text-neutral-100",children:"Racha Semanal"}),e.jsxs("p",{className:"text-xs text-neutral-600 dark:text-neutral-400",children:[r.currentStreak," dÃ­as consecutivos"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg font-bold text-accent-600 dark:text-accent-400",children:r.currentStreak}),e.jsx("div",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:"dÃ­as"})]})]})}),e.jsx("div",{className:"dark:from-primary-900/20 dark:to-accent-900/20 mt-4 rounded-lg bg-gradient-to-r from-primary-50 to-accent-50 p-3",children:e.jsx("p",{className:"text-sm text-neutral-700 dark:text-neutral-300",children:c>=100&&l>=100?"Â¡Excelente! Has cumplido todas tus metas de hoy ðŸŽ‰":c>=100?"Â¡Meta de tarjetas cumplida! Sigue con el tiempo de estudio ðŸ’ª":l>=100?"Â¡Meta de tiempo cumplida! Intenta revisar mÃ¡s tarjetas ðŸ“š":c>50||l>50?"Â¡Vas por buen camino! Sigue asÃ­ ðŸš€":"Â¡Comienza tu sesiÃ³n de estudio para cumplir tus metas!"})})]})},He=()=>{const r=[{href:"/study",title:"Continuar Estudiando",description:"Revisa tus flashcards",icon:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),color:"primary",bgColor:"bg-primary-50 hover:bg-primary-100 dark:bg-primary-900/20 dark:hover:bg-primary-900/30",iconBg:"bg-primary-100 dark:bg-primary-900",iconColor:"text-primary-600 dark:text-primary-400"},{href:"/data",title:"Gestionar Datos",description:"Importar/exportar tarjetas",icon:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 12l2 2 4-4"})}),color:"secondary",bgColor:"bg-secondary-50 hover:bg-secondary-100 dark:bg-secondary-900/20 dark:hover:bg-secondary-900/30",iconBg:"bg-secondary-100 dark:bg-secondary-900",iconColor:"text-secondary-600 dark:text-secondary-400"},{href:"/settings",title:"ConfiguraciÃ³n",description:"Personalizar experiencia",icon:e.jsxs("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),color:"accent",bgColor:"bg-accent-50 hover:bg-accent-100 dark:bg-accent-900/20 dark:hover:bg-accent-900/30",iconBg:"bg-accent-100 dark:bg-accent-900",iconColor:"text-accent-600 dark:text-accent-400"}];return e.jsxs("div",{className:"rounded-xl border border-neutral-200 bg-white p-6 shadow-lg dark:border-gray-600 dark:bg-gray-800",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold text-neutral-900 dark:text-neutral-100",children:"Acciones RÃ¡pidas"}),e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:r.map((t,s)=>e.jsxs("a",{href:t.href,className:`flex items-center gap-3 p-4 ${t.bgColor} group rounded-lg transition-colors duration-200`,children:[e.jsx("div",{className:`h-10 w-10 ${t.iconBg} flex items-center justify-center rounded-lg transition-transform duration-200 group-hover:scale-110`,children:e.jsx("div",{className:t.iconColor,children:t.icon})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-neutral-900 dark:text-neutral-100",children:t.title}),e.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:t.description})]})]},s))}),e.jsx("div",{className:"mt-6 border-t border-neutral-200 pt-4 dark:border-gray-600",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{className:"rounded-lg bg-gray-50 p-3 dark:bg-gray-700",children:[e.jsx("div",{className:"mb-1 text-xs text-neutral-600 dark:text-neutral-400",children:"PrÃ³xima revisiÃ³n"}),e.jsx("div",{className:"text-sm font-medium text-neutral-900 dark:text-neutral-100",children:"En 2 horas"})]}),e.jsxs("div",{className:"rounded-lg bg-gray-50 p-3 dark:bg-gray-700",children:[e.jsx("div",{className:"mb-1 text-xs text-neutral-600 dark:text-neutral-400",children:"Tarjetas pendientes"}),e.jsx("div",{className:"text-sm font-medium text-neutral-900 dark:text-neutral-100",children:"12 tarjetas"})]})]})}),e.jsx("div",{className:"mt-4",children:e.jsxs("a",{href:"/study",className:"flex w-full transform items-center justify-center gap-2 rounded-lg bg-gradient-to-r from-primary-600 to-primary-700 px-4 py-3 font-medium text-white shadow-lg transition-all duration-200 hover:-translate-y-0.5 hover:from-primary-700 hover:to-primary-800 hover:shadow-xl",children:[e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 7l5 5m0 0l-5 5m5-5H6"})}),"Comenzar SesiÃ³n de Estudio"]})})]})},yt=({className:r=""})=>{const t=j(O),s=j(fe),o=j(me),n=j(be),a=j(ve),i=j(Se),c=j(B);return b.useEffect(()=>{if(t.length===0){const l=[{id:"session_1",date:new Date(Date.now()-1728e5).toISOString().split("T")[0],cardsReviewed:15,correctAnswers:12,totalTime:25,averageResponseTime:3.5},{id:"session_2",date:new Date(Date.now()-864e5).toISOString().split("T")[0],cardsReviewed:20,correctAnswers:18,totalTime:35,averageResponseTime:2.8},{id:"session_3",date:new Date().toISOString().split("T")[0],cardsReviewed:10,correctAnswers:9,totalTime:18,averageResponseTime:4.2}];O.set(l)}$e().catch(console.error)},[t.length]),c.stats&&!n?e.jsx("div",{className:`mx-auto max-w-7xl ${r}`,children:e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"h-12 w-12 animate-spin rounded-full border-b-2 border-primary-600"}),e.jsx("span",{className:"ml-3 text-neutral-600 dark:text-neutral-300",children:"Cargando dashboard..."})]})}):e.jsxs("div",{className:`mx-auto max-w-7xl ${r}`,children:[e.jsx("div",{className:"mb-8",children:e.jsx(_e,{flashcards:o,progressStats:s,studyHistory:t,dashboardStats:n,loading:c.stats})}),e.jsxs("div",{className:"mb-8 grid grid-cols-1 gap-8 lg:grid-cols-3",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(ze,{studySessions:t,months:6})}),e.jsx("div",{children:e.jsx(Ue,{studyHistory:t,dashboardActivity:a,loading:c.activity})})]}),e.jsxs("div",{className:"mb-8 grid grid-cols-1 gap-8 lg:grid-cols-2",children:[e.jsx("div",{children:e.jsx(Ke,{studyHistory:t,dashboardProgress:i,loading:c.progress})}),e.jsx("div",{children:e.jsx(We,{progressStats:s,studyHistory:t,dashboardStats:n,loading:c.stats})})]}),e.jsx("div",{className:"mb-8",children:e.jsx(He,{dashboardStats:n})})]})},pt=({onRate:r})=>{const t=[{label:"Again",quality:0,color:"bg-red-500 hover:bg-red-600",textColor:"text-white"},{label:"Hard",quality:1,color:"bg-orange-500 hover:bg-orange-600",textColor:"text-white"},{label:"Good",quality:2,color:"bg-yellow-500 hover:bg-yellow-600",textColor:"text-white"},{label:"Easy",quality:3,color:"bg-green-500 hover:bg-green-600",textColor:"text-white"}],s=o=>{if(typeof r=="function")r(o);else if(typeof r=="string"){const n=window[r];typeof n=="function"&&n(o)}};return e.jsx("div",{className:"mt-6 grid w-full max-w-md grid-cols-2 gap-3 px-2 sm:grid-cols-4",children:t.map(({label:o,quality:n,color:a,textColor:i})=>e.jsx("button",{onClick:()=>s(n),className:`touch-target rounded-lg p-4 text-base font-semibold ${i} ${a} touch-feedback focus-mobile shadow-md transition-all duration-200 ease-in-out hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-opacity-75 focus:ring-offset-2 focus:ring-offset-slate-200`,"aria-label":`Rate recall as ${o}`,children:o},o))})},Y=N(null),Q=N(null),oe=N(!0),X=N(null),K=N(null),we=J([Y,Q],(r,t)=>!!(r&&t&&t.accessToken)),Ge=J([Y,Q,we,oe,X,K],(r,t,s,o,n,a)=>({user:r,tokens:t,isAuthenticated:s,isLoading:o,error:n,lastActivity:a})),ne=r=>{Y.set(r),K.set(new Date),r&&M.logSecurityEvent("USER_STATE_UPDATED",{userId:r.userId},"low")},ie=r=>{Q.set(r),K.set(new Date)},k=r=>{oe.set(r)},I=r=>{X.set(r),K.set(new Date)},U=()=>{Y.set(null),Q.set(null),X.set(null),K.set(new Date),M.logSecurityEvent("AUTH_STATE_CLEARED",{},"low")},qe=async r=>{try{k(!0),I(null);const t=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),s=await t.json();if(!t.ok||!s.success){const o=s.error||"Login failed";return I(o),k(!1),M.logSecurityEvent("LOGIN_FAILED",{email:r.email,error:o},"medium"),!1}return await R.storeAccessToken(s.data.accessToken,s.data.expiresIn/1e3),R.storeRefreshTokenReference(s.data.refreshToken),ne(s.data.user),ie({accessToken:s.data.accessToken,refreshToken:s.data.refreshToken,expiresIn:s.data.expiresIn,tokenType:"Bearer"}),k(!1),q.startAutoRefresh(),M.logSecurityEvent("LOGIN_SUCCESS",{userId:s.data.user.userId,email:s.data.user.email},"low"),!0}catch(t){const s=t instanceof Error?t.message:"Login failed";return I(s),k(!1),M.logSecurityEvent("LOGIN_ERROR",{error:s},"medium"),!1}},Ve=async r=>{try{k(!0),I(null);const t=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),s=await t.json();if(!t.ok||!s.success){const o=s.error||"Registration failed";return I(o),k(!1),M.logSecurityEvent("REGISTRATION_FAILED",{email:r.email,error:o},"medium"),!1}return await R.storeAccessToken(s.data.tokens.accessToken,s.data.tokens.expiresIn/1e3),R.storeRefreshTokenReference(s.data.tokens.refreshToken),ne(s.data.user),ie(s.data.tokens),k(!1),q.startAutoRefresh(),M.logSecurityEvent("REGISTRATION_SUCCESS",{userId:s.data.user.userId,email:s.data.user.email},"low"),!0}catch(t){const s=t instanceof Error?t.message:"Registration failed";return I(s),k(!1),M.logSecurityEvent("REGISTRATION_ERROR",{error:s},"medium"),!1}},Je=async()=>{try{k(!0),await fetch("/api/auth/logout",{method:"POST",credentials:"include"}),R.clearTokens(),q.stopAutoRefresh(),U(),k(!1),M.logSecurityEvent("LOGOUT_SUCCESS",{},"low")}catch(r){console.error("Logout error:",r),R.clearTokens(),q.stopAutoRefresh(),U(),k(!1),M.logSecurityEvent("LOGOUT_ERROR",{error:r instanceof Error?r.message:"Unknown error"},"medium")}},Ye=async()=>{try{if(k(!0),I(null),await ge.checkAuthentication()){const t=await R.getAccessToken();if(t){const s=await fetch("/api/auth/me",{headers:{Authorization:`Bearer ${t}`}});if(s.ok){const o=await s.json();ne(o.data);const n=R.getTimeUntilExpiry();ie({accessToken:t,refreshToken:"",expiresIn:n,tokenType:"Bearer"})}}}else U();k(!1)}catch(r){console.error("Auth check error:",r),U(),k(!1)}},Qe=async()=>(await Ye(),ge.subscribe(t=>{t||U()})),je=b.createContext(null),Xe=({children:r})=>{const t=j(Ge),s=async()=>{try{await Qe()}catch(a){console.error("Failed to initialize auth:",a)}},o=async()=>{if(t.user?.userId)try{Ae(t.user.userId),await re.loadFlashcards(t.user.userId)}catch(a){console.error("Failed to load user flashcards:",a)}};b.useEffect(()=>{s()},[]),b.useEffect(()=>{t.isAuthenticated&&t.user&&o()},[t.isAuthenticated,t.user?.userId]);const n={...t,initializeAuth:s,loadUserFlashcards:o};return e.jsx(je.Provider,{value:n,children:r})},Ze=()=>{const r=b.useContext(je);if(!r){if(typeof window>"u")return{isAuthenticated:!1,isLoading:!1,user:null,tokens:null,error:null,lastActivity:null,initializeAuth:async()=>{},loadUserFlashcards:async()=>{}};throw new Error("useAuth must be used within an AuthProvider")}return r},ke=({size:r="md",color:t="primary",className:s="",text:o,fullScreen:n=!1,overlay:a=!1})=>{const i=()=>{switch(r){case"sm":return"w-4 h-4";case"md":return"w-6 h-6";case"lg":return"w-8 h-8";case"xl":return"w-12 h-12";default:return"w-6 h-6"}},c=()=>{switch(t){case"primary":return"text-primary-500";case"secondary":return"text-secondary-500";case"gray":return"text-gray-500";case"white":return"text-white";default:return"text-primary-500"}},l=e.jsxs("div",{className:`inline-flex flex-col items-center justify-center ${s}`,children:[e.jsxs("svg",{className:`animate-spin ${i()} ${c()}`,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","aria-hidden":"true",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),o&&e.jsx("span",{className:`mt-2 text-sm font-medium ${c()}`,"aria-live":"polite",children:o})]});return n?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-white/80 backdrop-blur-sm dark:bg-gray-900/80",children:l}):a?e.jsx("div",{className:"absolute inset-0 z-10 flex items-center justify-center rounded-lg bg-white/60 backdrop-blur-sm dark:bg-gray-900/60",children:l}):l},et=({isOpen:r,onClose:t,initialMode:s="login",onSuccess:o})=>{const[n,a]=b.useState(s),[i,c]=b.useState({email:"",password:"",confirmPassword:"",username:""}),l=j(oe),m=j(X),d=j(we);b.useEffect(()=>{d&&r&&(o?.(),t(),window.dispatchEvent(new CustomEvent("auth-success")))},[d,r,o,t]),b.useEffect(()=>{a(s)},[s]);const h=()=>{c({email:"",password:"",confirmPassword:"",username:""})},y=async x=>{if(x.preventDefault(),n==="register"){if(i.password!==i.confirmPassword)return;await Ve({email:i.email,password:i.password,confirmPassword:i.confirmPassword,username:i.username||void 0})}else await qe({email:i.email,password:i.password,deviceInfo:navigator.userAgent})},g=x=>{c(p=>({...p,[x.target.name]:x.target.value}))},S=()=>{a(x=>x==="login"?"register":"login"),h()};return r?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"relative w-full max-w-md rounded-2xl bg-white shadow-2xl dark:bg-gray-800",children:[e.jsx("button",{onClick:t,className:"absolute right-4 top-4 text-gray-400 transition-colors hover:text-gray-600 dark:hover:text-gray-200","aria-label":"Cerrar modal",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsx("h2",{className:"mb-2 text-3xl font-bold text-gray-900 dark:text-white",children:n==="login"?"Iniciar SesiÃ³n":"Crear Cuenta"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:n==="login"?"Accede a tus flashcards personalizadas":"Ãšnete y comienza a aprender inglÃ©s"})]}),m&&e.jsx("div",{className:"mb-6 rounded-lg border border-red-200 bg-red-50 p-4 dark:border-red-700 dark:bg-red-900/50",children:e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:m})}),e.jsxs("form",{onSubmit:y,className:"space-y-6",children:[n==="register"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"auth-username",className:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Nombre de usuario (opcional)"}),e.jsx("input",{type:"text",name:"username",id:"auth-username",value:i.username,onChange:g,className:"w-full rounded-lg border border-gray-300 px-4 py-3 transition-colors focus:border-transparent focus:ring-2 focus:ring-primary-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"Tu nombre de usuario"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"auth-email",className:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Correo electrÃ³nico"}),e.jsx("input",{type:"email",name:"email",id:"auth-email",value:i.email,onChange:g,required:!0,className:"w-full rounded-lg border border-gray-300 px-4 py-3 transition-colors focus:border-transparent focus:ring-2 focus:ring-primary-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"tu@email.com"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"auth-password",className:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"ContraseÃ±a"}),e.jsx("input",{type:"password",name:"password",id:"auth-password",value:i.password,onChange:g,required:!0,minLength:8,className:"w-full rounded-lg border border-gray-300 px-4 py-3 transition-colors focus:border-transparent focus:ring-2 focus:ring-primary-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"}),n==="register"&&e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"MÃ­nimo 8 caracteres, incluye mayÃºsculas, minÃºsculas y nÃºmeros"})]}),n==="register"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"auth-confirm-password",className:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Confirmar contraseÃ±a"}),e.jsx("input",{type:"password",name:"confirmPassword",id:"auth-confirm-password",value:i.confirmPassword,onChange:g,required:!0,className:"w-full rounded-lg border border-gray-300 px-4 py-3 transition-colors focus:border-transparent focus:ring-2 focus:ring-primary-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"}),i.password&&i.confirmPassword&&i.password!==i.confirmPassword&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:"Las contraseÃ±as no coinciden"})]}),e.jsx("button",{type:"submit",disabled:l||n==="register"&&i.password!==i.confirmPassword,className:"flex w-full items-center justify-center rounded-lg bg-primary-600 px-4 py-3 font-semibold text-white transition-colors hover:bg-primary-700 disabled:bg-primary-400",children:l?e.jsxs(e.Fragment,{children:[e.jsx(ke,{size:"sm",color:"white",className:"mr-2"}),n==="login"?"Iniciando sesiÃ³n...":"Creando cuenta..."]}):n==="login"?"Iniciar SesiÃ³n":"Crear Cuenta"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:[n==="login"?"Â¿No tienes cuenta?":"Â¿Ya tienes cuenta?"," ",e.jsx("button",{onClick:S,className:"font-medium text-primary-600 transition-colors hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300",children:n==="login"?"Crear una cuenta":"Iniciar sesiÃ³n"})]})})]})]})}):null},tt=({className:r=""})=>{const{isAuthenticated:t,user:s,isLoading:o}=Ze(),[n,a]=b.useState(!1),[i,c]=b.useState("login");Me.useEffect(()=>{const y=g=>{const S=g.detail?.mode||"login";c(S),a(!0)};return window.addEventListener("open-auth-modal",y),()=>{window.removeEventListener("open-auth-modal",y)}},[]);const l=()=>{c("login"),a(!0)},m=()=>{c("register"),a(!0)},d=async()=>{await Je()},h=()=>{a(!1)};return o?e.jsx("div",{className:`flex items-center justify-center ${r}`,children:e.jsx(ke,{size:"sm",color:"primary"})}):t&&s?e.jsxs("div",{className:`flex items-center space-x-3 ${r}`,children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-primary-100 dark:bg-primary-800",children:e.jsx("span",{className:"text-sm font-semibold text-primary-600 dark:text-primary-300",children:s.username?.charAt(0).toUpperCase()||s.email?.charAt(0).toUpperCase()||"U"})}),e.jsxs("div",{className:"hidden sm:block",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:s.username||s.email?.split("@")[0]||"Usuario"}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[s.statistics?.totalCardsStudied||0," tarjetas estudiadas"]})]}),e.jsx("button",{onClick:d,className:"rounded-lg p-2 text-gray-500 transition-colors hover:bg-gray-100 hover:text-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-gray-200","aria-label":"Cerrar sesiÃ³n",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`flex items-center space-x-2 ${r}`,children:[e.jsx("button",{onClick:l,className:"text-sm font-medium text-primary-600 transition-colors hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300",children:"Iniciar SesiÃ³n"}),e.jsx("span",{className:"text-gray-300 dark:text-gray-600",children:"|"}),e.jsx("button",{onClick:m,className:"rounded-lg bg-primary-600 px-3 py-1.5 text-sm font-medium text-white transition-colors hover:bg-primary-700",children:"Registrarse"})]}),e.jsx(et,{isOpen:n,onClose:()=>a(!1),initialMode:i,onSuccess:h})]})},ft=({children:r,showUserProfile:t=!0,showCreateButton:s=!0})=>e.jsxs(Xe,{children:[r,t&&e.jsx("div",{className:"fixed right-16 top-0 z-50 flex h-16 items-center px-4",children:e.jsx(tt,{})}),s&&e.jsx(Re,{})]}),st=b.createContext(void 0),bt=({children:r})=>{const t={showError:(s,o)=>{console.log("Error:",s,o)},showInfo:(s,o)=>{console.log("Info:",s,o)},preferences:{enableSound:!0,highContrast:!1,largeText:!1,reduceMotion:!1}};return e.jsx(st.Provider,{value:t,children:r})},rt=({userId:r,className:t=""})=>{const s=pe(),o=()=>r?s.syncInProgress?{icon:"ðŸ”„",color:"text-blue-500"}:s.isOnline?s.lastSyncError?{icon:"âš ï¸",color:"text-red-500"}:s.pendingChanges>0?{icon:"â³",color:"text-yellow-500"}:{icon:"âœ…",color:"text-green-500"}:{icon:"ðŸ“¶",color:"text-orange-500"}:{icon:"ðŸ’¾",color:"text-gray-500"},{icon:n,color:a}=o();return e.jsxs("div",{className:`flex items-center space-x-1 ${t}`,children:[e.jsx("span",{className:`${a} text-sm`,title:r?s.syncInProgress?"Syncing...":s.isOnline?s.lastSyncError?"Sync error":s.pendingChanges>0?`${s.pendingChanges} pending changes`:"Synced":"Offline":"Local storage only",children:n}),s.pendingChanges>0&&e.jsx("span",{className:"rounded bg-yellow-100 px-1 text-xs text-yellow-600",children:s.pendingChanges})]})},vt=({userId:r,onDataImported:t,onDataExported:s})=>{const[o,n]=b.useState(!1),[a,i]=b.useState(!1),[c,l]=b.useState(!1),[m,d]=b.useState(null),h=b.useRef(null),y=j(me),g=j(O),{migrateData:S,isMigrating:x,progress:p,createBackup:u}=Be();b.useEffect(()=>{r&&(re.loadFlashcards(r),se.loadStudySessions(r))},[r]);const f=async()=>{n(!0);try{const T=$.exportAllData();$.downloadExportData(T),d({type:"success",text:"Data exported successfully!"})}catch{d({type:"error",text:"Failed to export data. Please try again."})}finally{n(!1)}},v=async()=>{n(!0);try{const T=$.exportProgressData();$.downloadExportData(T,`linguaflip-progress-${new Date().toISOString().split("T")[0]}.json`),d({type:"success",text:"Progress data exported successfully!"})}catch{d({type:"error",text:"Failed to export progress data. Please try again."})}finally{n(!1)}},w=async T=>{const ce=T.target.files?.[0];if(ce){i(!0),d(null);try{const ee=await $.importData(ce);ee.success?(d({type:"success",text:ee.message}),t?.()):d({type:"error",text:ee.message})}catch{d({type:"error",text:"An unexpected error occurred during import."})}finally{i(!1),h.current&&(h.current.value="")}}},P=()=>{h.current?.click()},Z=async()=>{if(!r){d({type:"error",text:"User ID required for MongoDB export"});return}n(!0);try{await L.forceSync(r),d({type:"success",text:"Data exported to MongoDB successfully!"}),s?.()}catch{d({type:"error",text:"Failed to export data to MongoDB"})}finally{n(!1)}},Ne=async()=>{if(!r){d({type:"error",text:"User ID required for MongoDB import"});return}i(!0);try{await Promise.all([re.loadFlashcards(r),se.loadStudySessions(r),se.loadProgressStats(r)]),d({type:"success",text:"Data imported from MongoDB successfully!"}),t?.()}catch{d({type:"error",text:"Failed to import data from MongoDB"})}finally{i(!1)}},Ce=async()=>{if(r){l(!0);try{await L.forceSync(r),d({type:"success",text:"Sync completed successfully!"})}catch{d({type:"error",text:"Sync failed. Please try again."})}finally{l(!1)}}},De=async()=>{if(!r){d({type:"error",text:"User ID required for data migration"});return}try{const T=await S(r);T.success?(d({type:"success",text:`Migration completed! Migrated ${T.migratedItems.flashcards} flashcards and ${T.migratedItems.studySessions} study sessions.`}),t?.()):d({type:"error",text:`Migration failed: ${T.errors.join(", ")}`})}catch{d({type:"error",text:"Migration failed unexpectedly"})}},Te=()=>{try{u(),d({type:"success",text:"Backup created successfully!"})}catch{d({type:"error",text:"Failed to create backup"})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"relative text-center",children:[e.jsx("h2",{className:"mb-2 text-2xl font-bold text-gray-900",children:"Data Management"}),e.jsx("p",{className:"text-gray-600",children:"Export and import your learning progress"}),r&&e.jsx("div",{className:"absolute right-0 top-0",children:e.jsx(rt,{userId:r})})]}),e.jsxs("div",{className:"rounded-xl bg-white p-6 shadow-lg",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold text-gray-900",children:"Current Data"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"rounded-lg bg-blue-50 p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:y.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Flashcards"})]}),e.jsxs("div",{className:"rounded-lg bg-green-50 p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:g.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Study Sessions"})]}),e.jsxs("div",{className:"rounded-lg bg-purple-50 p-4 text-center",children:[e.jsx("div",{className:"text-sm font-bold text-purple-600",children:r?"Connected":"Local Only"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Storage Mode"})]})]})]}),r&&e.jsxs("div",{className:"rounded-xl bg-white p-6 shadow-lg",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold text-gray-900",children:"MongoDB Sync"}),e.jsx("p",{className:"mb-6 text-gray-600",children:"Synchronize your data with MongoDB for cross-device access and backup."}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs("button",{onClick:Z,disabled:o||c,className:"flex flex-col items-center rounded-lg border-2 border-blue-200 p-6 transition-all hover:border-blue-300 hover:bg-blue-50 disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx("div",{className:"mb-3 text-3xl",children:"â˜ï¸"}),e.jsx("h4",{className:"mb-1 font-semibold text-gray-900",children:"Sync to MongoDB"}),e.jsx("p",{className:"mb-3 text-center text-sm text-gray-600",children:"Upload local data to cloud"}),e.jsx("span",{className:"rounded-lg bg-blue-600 px-4 py-2 text-sm text-white transition-colors hover:bg-blue-700",children:o?"Syncing...":"Sync Up"})]}),e.jsxs("button",{onClick:Ne,disabled:a||c,className:"flex flex-col items-center rounded-lg border-2 border-green-200 p-6 transition-all hover:border-green-300 hover:bg-green-50 disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx("div",{className:"mb-3 text-3xl",children:"â¬‡ï¸"}),e.jsx("h4",{className:"mb-1 font-semibold text-gray-900",children:"Sync from MongoDB"}),e.jsx("p",{className:"mb-3 text-center text-sm text-gray-600",children:"Download latest data from cloud"}),e.jsx("span",{className:"rounded-lg bg-green-600 px-4 py-2 text-sm text-white transition-colors hover:bg-green-700",children:a?"Loading...":"Sync Down"})]}),e.jsxs("button",{onClick:Ce,disabled:c,className:"flex flex-col items-center rounded-lg border-2 border-purple-200 p-6 transition-all hover:border-purple-300 hover:bg-purple-50 disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx("div",{className:"mb-3 text-3xl",children:"ðŸ”„"}),e.jsx("h4",{className:"mb-1 font-semibold text-gray-900",children:"Force Sync"}),e.jsx("p",{className:"mb-3 text-center text-sm text-gray-600",children:"Manual synchronization"}),e.jsx("span",{className:"rounded-lg bg-purple-600 px-4 py-2 text-sm text-white transition-colors hover:bg-purple-700",children:c?"Syncing...":"Force Sync"})]})]})]}),r&&e.jsxs("div",{className:"rounded-xl bg-white p-6 shadow-lg",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold text-gray-900",children:"Data Migration"}),e.jsx("p",{className:"mb-6 text-gray-600",children:"Migrate existing localStorage data to MongoDB for the first time."}),x&&p&&e.jsxs("div",{className:"mb-6 rounded-lg border border-blue-200 bg-blue-50 p-4",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-blue-800",children:p.stage.replace("_"," ").toUpperCase()}),e.jsxs("span",{className:"text-sm text-blue-600",children:[p.processedItems,"/",p.totalItems]})]}),e.jsx("div",{className:"mb-2 h-2 w-full rounded-full bg-blue-200",children:e.jsx("div",{className:"h-2 rounded-full bg-blue-600 transition-all duration-300",style:{width:`${p.processedItems/p.totalItems*100}%`}})}),e.jsx("div",{className:"text-xs text-blue-700",children:p.currentItem})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("button",{onClick:De,disabled:x,className:"flex flex-col items-center rounded-lg border-2 border-orange-200 p-6 transition-all hover:border-orange-300 hover:bg-orange-50 disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx("div",{className:"mb-3 text-3xl",children:"ðŸš€"}),e.jsx("h4",{className:"mb-1 font-semibold text-gray-900",children:"Migrate to MongoDB"}),e.jsx("p",{className:"mb-3 text-center text-sm text-gray-600",children:"Move local data to cloud storage"}),e.jsx("span",{className:"rounded-lg bg-orange-600 px-4 py-2 text-sm text-white transition-colors hover:bg-orange-700",children:x?"Migrating...":"Start Migration"})]}),e.jsxs("button",{onClick:Te,className:"flex flex-col items-center rounded-lg border-2 border-gray-200 p-6 transition-all hover:border-gray-300 hover:bg-gray-50",children:[e.jsx("div",{className:"mb-3 text-3xl",children:"ðŸ’¾"}),e.jsx("h4",{className:"mb-1 font-semibold text-gray-900",children:"Create Backup"}),e.jsx("p",{className:"mb-3 text-center text-sm text-gray-600",children:"Download local data backup"}),e.jsx("span",{className:"rounded-lg bg-gray-600 px-4 py-2 text-sm text-white transition-colors hover:bg-gray-700",children:"Create Backup"})]})]})]}),e.jsxs("div",{className:"rounded-xl bg-white p-6 shadow-lg",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold text-gray-900",children:"Export Data"}),e.jsx("p",{className:"mb-6 text-gray-600",children:"Download your learning data to backup or transfer to another device."}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("button",{onClick:f,disabled:o,className:"flex flex-col items-center rounded-lg border-2 border-blue-200 p-6 transition-all hover:border-blue-300 hover:bg-blue-50 disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx("div",{className:"mb-3 text-3xl",children:"ðŸ“¦"}),e.jsx("h4",{className:"mb-1 font-semibold text-gray-900",children:"Export All Data"}),e.jsx("p",{className:"mb-3 text-center text-sm text-gray-600",children:"Includes flashcards and study history"}),e.jsx("span",{className:"rounded-lg bg-blue-600 px-4 py-2 text-sm text-white transition-colors hover:bg-blue-700",children:o?"Exporting...":"Export All"})]}),e.jsxs("button",{onClick:v,disabled:o,className:"flex flex-col items-center rounded-lg border-2 border-green-200 p-6 transition-all hover:border-green-300 hover:bg-green-50 disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx("div",{className:"mb-3 text-3xl",children:"ðŸ“Š"}),e.jsx("h4",{className:"mb-1 font-semibold text-gray-900",children:"Export Progress Only"}),e.jsx("p",{className:"mb-3 text-center text-sm text-gray-600",children:"Study sessions and statistics only"}),e.jsx("span",{className:"rounded-lg bg-green-600 px-4 py-2 text-sm text-white transition-colors hover:bg-green-700",children:o?"Exporting...":"Export Progress"})]})]})]}),e.jsxs("div",{className:"rounded-xl bg-white p-6 shadow-lg",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold text-gray-900",children:"Import Data"}),e.jsx("p",{className:"mb-6 text-gray-600",children:"Restore your learning data from a previously exported file."}),e.jsxs("div",{className:"text-center",children:[e.jsx("input",{ref:h,type:"file",accept:".json",onChange:w,className:"hidden"}),e.jsx("button",{onClick:P,disabled:a,className:"rounded-lg bg-purple-600 px-6 py-3 font-semibold text-white transition-colors hover:bg-purple-700 disabled:cursor-not-allowed disabled:opacity-50",children:a?"Importing...":"Choose File to Import"}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"Only .json files exported from LinguaFlip are supported"})]})]}),m&&e.jsx("div",{className:`rounded-lg p-4 ${m.type==="success"?"border border-green-200 bg-green-50 text-green-800":"border border-red-200 bg-red-50 text-red-800"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:m.type==="success"?e.jsx("svg",{className:"h-5 w-5 text-green-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}):e.jsx("svg",{className:"h-5 w-5 text-red-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm font-medium",children:m.text})}),e.jsx("div",{className:"ml-auto pl-3",children:e.jsx("button",{onClick:()=>d(null),className:"inline-flex rounded-md p-1.5 focus:outline-none focus:ring-2 focus:ring-gray-600 focus:ring-offset-2",children:e.jsx("svg",{className:"h-5 w-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})})]})}),e.jsx("div",{className:"rounded-lg border border-yellow-200 bg-yellow-50 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"Important Notes"}),e.jsx("div",{className:"mt-2 text-sm text-yellow-700",children:e.jsxs("ul",{className:"list-inside list-disc space-y-1",children:[e.jsx("li",{children:"Importing data will overwrite your current progress"}),e.jsx("li",{children:"Make sure to backup your current data before importing"}),e.jsx("li",{children:"Only import files that were exported from LinguaFlip"}),r&&e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"MongoDB operations require an active internet connection"}),e.jsx("li",{children:"Data migration is a one-time process - run it only once"}),e.jsx("li",{children:"Create a backup before migrating to MongoDB"})]})]})})]})]})})]})},C={getElementById(r){return document.getElementById(r)},dispatchCustomEvent(r,t){const s=new CustomEvent(r,{bubbles:!0,detail:{...t,source:"header"}});document.dispatchEvent(s)},toggleAriaExpanded(r){const t=r.getAttribute("aria-expanded")==="true";r.setAttribute("aria-expanded",t?"false":"true")}},de={initializeToggle(){const r=C.getElementById("sidebar-toggle");r&&r.addEventListener("click",()=>{C.dispatchCustomEvent("sidebarToggle",{})})},initializeStateListener(){document.addEventListener("sidebarStateChange",r=>{const{isOpen:t}=r.detail,s=C.getElementById("sidebar-toggle");s&&s.setAttribute("aria-expanded",t?"true":"false")})}},ue={initialize(){const r=C.getElementById("user-menu-button"),t=C.getElementById("user-dropdown-menu");!r||!t||this.attachEventListeners(r,t)},attachEventListeners(r,t){r.addEventListener("click",s=>{s.stopPropagation(),C.toggleAriaExpanded(r),t.classList.toggle("hidden")}),document.addEventListener("click",s=>{const o=s.target;!(r.contains(o)||t.contains(o))&&!t.classList.contains("hidden")&&this.closeMenu(r,t)}),r.addEventListener("keydown",s=>{s.key==="Escape"&&!t.classList.contains("hidden")&&(this.closeMenu(r,t),r.focus())})},closeMenu(r,t){t.classList.add("hidden"),r.setAttribute("aria-expanded","false")}},at={initialize(){const r=C.getElementById("help-button"),t=C.getElementById("notifications-button");r&&this.attachHelpButtonListener(r),t&&this.attachNotificationsButtonListener(t)},attachHelpButtonListener(r){r.addEventListener("click",()=>{C.dispatchCustomEvent("quickAction",{action:"help"})})},attachNotificationsButtonListener(r){r.addEventListener("click",()=>{C.dispatchCustomEvent("quickAction",{action:"notifications"})})}},ot={initialize(){de.initializeToggle(),de.initializeStateListener(),ue.initialize(),at.initialize(),this.setupSmoothTransitions(),this.setupGlobalEventListeners()},setupSmoothTransitions(){document.addEventListener("DOMContentLoaded",()=>{const r=document.querySelector("header");r&&(r.style.transition="all 0.2s ease-in-out")})},setupGlobalEventListeners(){document.addEventListener("keydown",r=>{r.key==="Escape"&&this.closeAllDropdowns()})},closeAllDropdowns(){const r=C.getElementById("user-dropdown-menu"),t=C.getElementById("user-menu-button");r&&t&&!r.classList.contains("hidden")&&ue.closeMenu(t,r)}};function he(){ot.initialize()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",he):he();export{et as A,vt as D,ke as L,pt as R,mt as T,yt as a,ft as b,te as c,bt as d,gt as e,L as h,xt as p,O as s,Ze as u};
